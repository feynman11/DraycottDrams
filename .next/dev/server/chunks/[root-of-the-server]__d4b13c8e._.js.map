{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/db/schema.ts"],"sourcesContent":["import { pgTable, text, timestamp, integer, decimal, jsonb, boolean, uuid } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema, createSelectSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const UserRole = {\n  PUBLIC: \"public\",\n  USER: \"user\",\n  MEMBER: \"member\",\n  ADMIN: \"admin\",\n} as const;\n\nexport const ParticipationStatus = {\n  REGISTERED: \"registered\",\n  ATTENDED: \"attended\",\n  NO_SHOW: \"no_show\",\n} as const;\n\n// Tables\nexport const users = pgTable(\"users\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  email: text(\"email\").unique().notNull(),\n  emailVerified: timestamp(\"email_verified\", { mode: \"date\" }),\n  name: text(\"name\"),\n  image: text(\"image\"),\n  role: text(\"role\").$default(() => UserRole.USER).notNull(),\n  lastLogin: timestamp(\"last_login\", { mode: \"date\" }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const whiskies = pgTable(\"whiskies\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text(\"name\").notNull(),\n  distillery: text(\"distillery\").notNull(),\n  region: text(\"region\").notNull(),\n  country: text(\"country\").notNull(),\n  type: text(\"type\").notNull(),\n  abv: decimal(\"abv\", { precision: 4, scale: 1 }).notNull(),\n  age: integer(\"age\"),\n  priceRange: text(\"price_range\"),\n  description: text(\"description\").notNull(),\n  tastingNotes: jsonb(\"tasting_notes\").$type<string[]>().notNull(),\n  coordinates: jsonb(\"coordinates\").$type<[number, number]>().notNull(), // [longitude, latitude]\n  flavorProfile: jsonb(\"flavor_profile\").$type<{\n    peat: number;\n    fruit: number;\n    floral: number;\n    spice: number;\n    wood: number;\n    sweetness: number;\n  }>().notNull(),\n  imageUrl: text(\"image_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const tastings = pgTable(\"tastings\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  userId: text(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  whiskyId: text(\"whisky_id\").references(() => whiskies.id, { onDelete: \"cascade\" }).notNull(),\n  rating: integer(\"rating\").notNull(),\n  notes: text(\"notes\"),\n  tastingDate: timestamp(\"tasting_date\", { mode: \"date\" }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const tastingNotes = pgTable(\"tasting_notes\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  tastingId: text(\"tasting_id\").references(() => tastings.id, { onDelete: \"cascade\" }).notNull(),\n  note: text(\"note\").notNull(),\n  intensity: integer(\"intensity\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Zod schemas for validation\nexport const insertUserSchema = createInsertSchema(users);\nexport const selectUserSchema = createSelectSchema(users);\n\nexport const insertWhiskySchema = createInsertSchema(whiskies);\n\nexport const selectWhiskySchema = createSelectSchema(whiskies);\n\nexport const insertTastingSchema = createInsertSchema(tastings);\nexport const selectTastingSchema = createSelectSchema(tastings);\n\nexport const insertTastingNoteSchema = createInsertSchema(tastingNotes);\nexport const selectTastingNoteSchema = createSelectSchema(tastingNotes);\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\n\nexport type Whisky = typeof whiskies.$inferSelect;\nexport type NewWhisky = typeof whiskies.$inferInsert;\n\nexport type Tasting = typeof tastings.$inferSelect;\nexport type NewTasting = typeof tastings.$inferInsert;\n\nexport type TastingNote = typeof tastingNotes.$inferSelect;\nexport type NewTastingNote = typeof tastingNotes.$inferInsert;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 265, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/db.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/postgres-js\";\nimport postgres from \"postgres\";\nimport * as schema from \"@/db/schema\";\n\n// Database connection\nconst connectionString = process.env.DATABASE_URL!;\n\n// Create the connection\nconst client = postgres(connectionString, { prepare: false });\n\n// Create the drizzle instance\nexport const db = drizzle(client, { schema });\n\n// Export for testing/cleanup\nexport { client };\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,sBAAsB;AACtB,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,wBAAwB;AACxB,MAAM,SAAS,IAAA,qJAAQ,EAAC,kBAAkB;IAAE,SAAS;AAAM;AAGpD,MAAM,KAAK,IAAA,uKAAO,EAAC,QAAQ;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/trpc.ts"],"sourcesContent":["import { initTRPC } from \"@trpc/server\";\nimport { auth } from \"next-auth/next\";\nimport { db } from \"@/lib/db\";\nimport superjson from \"superjson\";\nimport type { NextRequest } from \"next/server\";\n\nexport const createTRPCContext = async (req: NextRequest) => {\n  // Get user session\n  const session = await auth({ req });\n\n  return {\n    db,\n    session,\n  };\n};\n\nconst t = initTRPC.context<typeof createTRPCContext>().create({\n  transformer: superjson,\n});\n\nexport const createCallerFactory = t.createCallerFactory;\nexport const createTRPCRouter = t.router;\nexport const publicProcedure = t.procedure;\nexport const protectedProcedure = t.procedure.use(({ ctx, next }) => {\n  if (!ctx.session?.user) {\n    throw new Error(\"Unauthorized\");\n  }\n  return next({\n    ctx: {\n      ...ctx,\n      session: { ...ctx.session, user: ctx.session.user },\n    },\n  });\n});\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAGO,MAAM,oBAAoB,OAAO;IACtC,mBAAmB;IACnB,MAAM,UAAU,MAAM,IAAA,uJAAI,EAAC;QAAE;IAAI;IAEjC,OAAO;QACL,IAAA,iHAAE;QACF;IACF;AACF;AAEA,MAAM,IAAI,+KAAQ,CAAC,OAAO,GAA6B,MAAM,CAAC;IAC5D,aAAa,uJAAS;AACxB;AAEO,MAAM,sBAAsB,EAAE,mBAAmB;AACjD,MAAM,mBAAmB,EAAE,MAAM;AACjC,MAAM,kBAAkB,EAAE,SAAS;AACnC,MAAM,qBAAqB,EAAE,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE;IAC9D,IAAI,CAAC,IAAI,OAAO,EAAE,MAAM;QACtB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,KAAK;QACV,KAAK;YACH,GAAG,GAAG;YACN,SAAS;gBAAE,GAAG,IAAI,OAAO;gBAAE,MAAM,IAAI,OAAO,CAAC,IAAI;YAAC;QACpD;IACF;AACF"}},
    {"offset": {"line": 345, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/routers/whisky.ts"],"sourcesContent":["import { createTRPCRouter, publicProcedure } from \"@/lib/trpc\";\nimport { db } from \"@/lib/db\";\nimport { whiskies } from \"@/db/schema\";\nimport { eq, ilike, sql, and } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\nexport const whiskyRouter = createTRPCRouter({\n  // Get all whiskies with optional filtering\n  getAll: publicProcedure\n    .input(\n      z.object({\n        search: z.string().optional(),\n        region: z.string().optional(),\n        type: z.string().optional(),\n        limit: z.number().min(1).max(100).default(50),\n        offset: z.number().min(0).default(0),\n      }).optional()\n    )\n    .query(async ({ input }) => {\n      const { search, region, type, limit = 50, offset = 0 } = input || {};\n\n      let whereConditions = [];\n\n      if (search) {\n        whereConditions.push(ilike(whiskies.name, `%${search}%`));\n      }\n\n      if (region) {\n        whereConditions.push(eq(whiskies.region, region));\n      }\n\n      if (type) {\n        whereConditions.push(eq(whiskies.type, type));\n      }\n\n      const result = await db\n        .select()\n        .from(whiskies)\n        .where(whereConditions.length > 0 ? and(...whereConditions) : undefined)\n        .limit(limit)\n        .offset(offset);\n      return result;\n    }),\n\n  // Get whisky by ID\n  getById: publicProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ input }) => {\n      const { id } = input;\n\n      const result = await db\n        .select()\n        .from(whiskies)\n        .where(eq(whiskies.id, id))\n        .limit(1);\n\n      if (result.length === 0) {\n        throw new Error(\"Whisky not found\");\n      }\n\n      return result[0];\n    }),\n\n  // Get whiskies by location proximity (simplified)\n  getNearby: publicProcedure\n    .input(\n      z.object({\n        lat: z.number(),\n        lng: z.number(),\n        radius: z.number().default(1000), // km\n        limit: z.number().min(1).max(50).default(20),\n      })\n    )\n    .query(async ({ input }) => {\n      const { lat, lng, radius, limit } = input;\n\n      // Simple distance calculation using PostgreSQL's earthdistance extension would be ideal\n      // For now, we'll return all whiskies (in a real implementation, use proper geospatial queries)\n      const result = await db\n        .select()\n        .from(whiskies)\n        .limit(limit);\n\n      return result;\n    }),\n\n  // Get whisky statistics\n  getStats: publicProcedure.query(async () => {\n    const totalCount = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(whiskies);\n\n    const regions = await db\n      .select({\n        region: whiskies.region,\n        count: sql<number>`count(*)`,\n      })\n      .from(whiskies)\n      .groupBy(whiskies.region);\n\n    const types = await db\n      .select({\n        type: whiskies.type,\n        count: sql<number>`count(*)`,\n      })\n      .from(whiskies)\n      .groupBy(whiskies.type);\n\n    return {\n      total: totalCount[0]?.count || 0,\n      regions,\n      types,\n    };\n  }),\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 431, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/routers/user.ts"],"sourcesContent":["import { createTRPCRouter, protectedProcedure } from \"@/lib/trpc\";\nimport { db } from \"@/lib/db\";\nimport { users } from \"@/db/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\nexport const userRouter = createTRPCRouter({\n  // Get current user profile\n  getProfile: protectedProcedure.query(async ({ ctx }) => {\n    const { session } = ctx;\n\n    if (!session?.user?.id) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    const result = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, session.user.id))\n      .limit(1);\n\n    if (result.length === 0) {\n      throw new Error(\"User not found\");\n    }\n\n    return result[0];\n  }),\n\n  // Update user profile\n  updateProfile: protectedProcedure\n    .input(\n      z.object({\n        name: z.string().optional(),\n        image: z.string().optional(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const { session } = ctx;\n\n      if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n      }\n\n      const result = await db\n        .update(users)\n        .set({\n          ...input,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, session.user.id))\n        .returning();\n\n      return result[0];\n    }),\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,aAAa,IAAA,iIAAgB,EAAC;IACzC,2BAA2B;IAC3B,YAAY,mIAAkB,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE;QACjD,MAAM,EAAE,OAAO,EAAE,GAAG;QAEpB,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,SAAS,MAAM,iHAAE,CACpB,MAAM,GACN,IAAI,CAAC,uHAAK,EACV,KAAK,CAAC,IAAA,0KAAE,EAAC,uHAAK,CAAC,EAAE,EAAE,QAAQ,IAAI,CAAC,EAAE,GAClC,KAAK,CAAC;QAET,IAAI,OAAO,MAAM,KAAK,GAAG;YACvB,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,MAAM,CAAC,EAAE;IAClB;IAEA,sBAAsB;IACtB,eAAe,mIAAkB,CAC9B,KAAK,CACJ,oLAAC,CAAC,MAAM,CAAC;QACP,MAAM,oLAAC,CAAC,MAAM,GAAG,QAAQ;QACzB,OAAO,oLAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,IAED,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE;QAC7B,MAAM,EAAE,OAAO,EAAE,GAAG;QAEpB,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,SAAS,MAAM,iHAAE,CACpB,MAAM,CAAC,uHAAK,EACZ,GAAG,CAAC;YACH,GAAG,KAAK;YACR,WAAW,IAAI;QACjB,GACC,KAAK,CAAC,IAAA,0KAAE,EAAC,uHAAK,CAAC,EAAE,EAAE,QAAQ,IAAI,CAAC,EAAE,GAClC,SAAS;QAEZ,OAAO,MAAM,CAAC,EAAE;IAClB;AACJ"}},
    {"offset": {"line": 478, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/routers/tasting.ts"],"sourcesContent":["import { createTRPCRouter, protectedProcedure, publicProcedure } from \"@/lib/trpc\";\nimport { db } from \"@/lib/db\";\nimport { tastings, tastingNotes, whiskies, users } from \"@/db/schema\";\nimport { eq, desc, and } from \"drizzle-orm\";\nimport { z } from \"zod\";\n\nexport const tastingRouter = createTRPCRouter({\n  // Create a new tasting\n  create: protectedProcedure\n    .input(\n      z.object({\n        whiskyId: z.string(),\n        rating: z.number().min(1).max(5),\n        notes: z.string().optional(),\n        tastingDate: z.date(),\n        tastingNotes: z.array(\n          z.object({\n            note: z.string(),\n            intensity: z.number().min(1).max(5),\n          })\n        ).optional(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const { session } = ctx;\n\n      if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n      }\n\n      const { whiskyId, rating, notes, tastingDate, tastingNotes: notesArray } = input;\n\n      // Create the tasting\n      const tastingResult = await db\n        .insert(tastings)\n        .values({\n          userId: session.user.id,\n          whiskyId,\n          rating,\n          notes,\n          tastingDate,\n        })\n        .returning();\n\n      const tasting = tastingResult[0];\n\n      // Create tasting notes if provided\n      if (notesArray && notesArray.length > 0) {\n        await db.insert(tastingNotes).values(\n          notesArray.map(note => ({\n            tastingId: tasting.id,\n            note: note.note,\n            intensity: note.intensity,\n          }))\n        );\n      }\n\n      return tasting;\n    }),\n\n  // Update an existing tasting\n  update: protectedProcedure\n    .input(\n      z.object({\n        id: z.string(),\n        rating: z.number().min(1).max(5).optional(),\n        notes: z.string().optional(),\n        tastingDate: z.date().optional(),\n        tastingNotes: z.array(\n          z.object({\n            note: z.string(),\n            intensity: z.number().min(1).max(5),\n          })\n        ).optional(),\n      })\n    )\n    .mutation(async ({ ctx, input }) => {\n      const { session } = ctx;\n\n      if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n      }\n\n      const { id, tastingNotes: notesArray, ...updateData } = input;\n\n      // Update the tasting\n      const tastingResult = await db\n        .update(tastings)\n        .set({\n          ...updateData,\n          updatedAt: new Date(),\n        })\n        .where(and(eq(tastings.id, id), eq(tastings.userId, session.user.id)))\n        .returning();\n\n      if (tastingResult.length === 0) {\n        throw new Error(\"Tasting not found or unauthorized\");\n      }\n\n      const tasting = tastingResult[0];\n\n      // Update tasting notes if provided\n      if (notesArray) {\n        // Delete existing notes\n        await db.delete(tastingNotes).where(eq(tastingNotes.tastingId, id));\n\n        // Insert new notes\n        if (notesArray.length > 0) {\n          await db.insert(tastingNotes).values(\n            notesArray.map(note => ({\n              tastingId: id,\n              note: note.note,\n              intensity: note.intensity,\n            }))\n          );\n        }\n      }\n\n      return tasting;\n    }),\n\n  // Delete a tasting\n  delete: protectedProcedure\n    .input(z.object({ id: z.string() }))\n    .mutation(async ({ ctx, input }) => {\n      const { session } = ctx;\n\n      if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n      }\n\n      const { id } = input;\n\n      // Delete tasting notes first (cascade should handle this, but being explicit)\n      await db.delete(tastingNotes).where(eq(tastingNotes.tastingId, id));\n\n      // Delete the tasting\n      const result = await db\n        .delete(tastings)\n        .where(and(eq(tastings.id, id), eq(tastings.userId, session.user.id)))\n        .returning();\n\n      if (result.length === 0) {\n        throw new Error(\"Tasting not found or unauthorized\");\n      }\n\n      return { success: true };\n    }),\n\n  // Get user's tastings\n  getUserTastings: protectedProcedure\n    .input(\n      z.object({\n        limit: z.number().min(1).max(100).default(20),\n        offset: z.number().min(0).default(0),\n      }).optional()\n    )\n    .query(async ({ ctx, input }) => {\n      const { session } = ctx;\n\n      if (!session?.user?.id) {\n        throw new Error(\"Unauthorized\");\n      }\n\n      const { limit = 20, offset = 0 } = input || {};\n\n      const result = await db\n        .select({\n          tasting: tastings,\n          whisky: {\n            id: whiskies.id,\n            name: whiskies.name,\n            distillery: whiskies.distillery,\n            region: whiskies.region,\n          },\n        })\n        .from(tastings)\n        .innerJoin(whiskies, eq(tastings.whiskyId, whiskies.id))\n        .where(eq(tastings.userId, session.user.id))\n        .orderBy(desc(tastings.tastingDate))\n        .limit(limit)\n        .offset(offset);\n\n      return result;\n    }),\n\n  // Get tastings for a specific whisky\n  getByWhisky: publicProcedure\n    .input(\n      z.object({\n        whiskyId: z.string(),\n        limit: z.number().min(1).max(50).default(10),\n      })\n    )\n    .query(async ({ input }) => {\n      const { whiskyId, limit } = input;\n\n      const result = await db\n        .select({\n          tasting: tastings,\n          user: {\n            id: users.id,\n            name: users.name,\n          },\n        })\n        .from(tastings)\n        .innerJoin(users, eq(tastings.userId, users.id))\n        .where(eq(tastings.whiskyId, whiskyId))\n        .orderBy(desc(tastings.tastingDate))\n        .limit(limit);\n\n      return result;\n    }),\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 630, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/routers/ai.ts"],"sourcesContent":["import { createTRPCRouter, publicProcedure, protectedProcedure } from \"@/lib/trpc\";\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { z } from \"zod\";\n\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!);\n\nexport const aiRouter = createTRPCRouter({\n  // Get whisky recommendations based on preferences\n  getRecommendation: publicProcedure\n    .input(\n      z.object({\n        preferences: z.object({\n          flavorProfile: z.object({\n            peat: z.number().min(0).max(100).optional(),\n            fruit: z.number().min(0).max(100).optional(),\n            floral: z.number().min(0).max(100).optional(),\n            spice: z.number().min(0).max(100).optional(),\n            wood: z.number().min(0).max(100).optional(),\n            sweetness: z.number().min(0).max(100).optional(),\n          }).optional(),\n          regions: z.array(z.string()).optional(),\n          types: z.array(z.string()).optional(),\n          priceRange: z.string().optional(),\n          experience: z.enum([\"beginner\", \"intermediate\", \"advanced\"]).optional(),\n        }),\n        context: z.string().optional(),\n      })\n    )\n    .query(async ({ input }) => {\n      const { preferences, context } = input;\n\n      try {\n        const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n\n        const prompt = `You are an expert whisky sommelier for the Draycott Drams whisky club. Based on the following preferences, recommend whiskies from our collection.\n\nUser Preferences:\n${preferences.flavorProfile ? `- Flavor Profile: ${JSON.stringify(preferences.flavorProfile)}` : \"\"}\n${preferences.regions?.length ? `- Preferred Regions: ${preferences.regions.join(\", \")}` : \"\"}\n${preferences.types?.length ? `- Preferred Types: ${preferences.types.join(\", \")}` : \"\"}\n${preferences.priceRange ? `- Price Range: ${preferences.priceRange}` : \"\"}\n${preferences.experience ? `- Experience Level: ${preferences.experience}` : \"\"}\n${context ? `- Additional Context: ${context}` : \"\"}\n\nPlease provide 3 whisky recommendations with brief explanations of why they match the preferences. Format your response as JSON with the following structure:\n{\n  \"recommendations\": [\n    {\n      \"name\": \"Whisky Name\",\n      \"reason\": \"Brief explanation of why this whisky matches the preferences\"\n    }\n  ]\n}`;\n\n        const result = await model.generateContent(prompt);\n        const response = await result.response;\n        const text = response.text();\n\n        // Try to parse the JSON response\n        try {\n          const parsed = JSON.parse(text);\n          return parsed;\n        } catch (parseError) {\n          // If JSON parsing fails, return a structured fallback\n          return {\n            recommendations: [\n              {\n                name: \"Unable to parse AI response\",\n                reason: \"Please try again with different preferences\",\n              },\n            ],\n          };\n        }\n      } catch (error) {\n        console.error(\"AI recommendation error:\", error);\n        throw new Error(\"Unable to generate recommendations at this time\");\n      }\n    }),\n\n  // Analyze tasting notes and provide insights\n  analyzeTasting: protectedProcedure\n    .input(\n      z.object({\n        whiskyName: z.string(),\n        tastingNotes: z.array(z.string()),\n        rating: z.number().min(1).max(5),\n        personalNotes: z.string().optional(),\n      })\n    )\n    .query(async ({ input }) => {\n      const { whiskyName, tastingNotes, rating, personalNotes } = input;\n\n      try {\n        const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n\n        const prompt = `You are an expert whisky sommelier analyzing a tasting experience for the Draycott Drams whisky club.\n\nWhisky: ${whiskyName}\nTasting Notes: ${tastingNotes.join(\", \")}\nRating: ${rating}/5\nPersonal Notes: ${personalNotes || \"None provided\"}\n\nPlease provide an analysis of this tasting experience. Include:\n1. What flavors and characteristics were detected\n2. How this compares to typical profiles for this whisky\n3. Suggestions for pairing or future tastings\n4. Any interesting observations about the tasting experience\n\nKeep your response conversational and expert-level, around 200-300 words.`;\n\n        const result = await model.generateContent(prompt);\n        const response = await result.response;\n        const text = response.text();\n\n        return {\n          analysis: text,\n          whiskyName,\n          tastingNotes,\n          rating,\n        };\n      } catch (error) {\n        console.error(\"AI tasting analysis error:\", error);\n        throw new Error(\"Unable to analyze tasting at this time\");\n      }\n    }),\n\n  // General whisky chat/conversation\n  chat: publicProcedure\n    .input(\n      z.object({\n        message: z.string(),\n        context: z.array(\n          z.object({\n            role: z.enum([\"user\", \"assistant\"]),\n            content: z.string(),\n          })\n        ).optional(),\n      })\n    )\n    .mutation(async ({ input }) => {\n      const { message, context = [] } = input;\n\n      try {\n        const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\n\n        const systemPrompt = `You are an AI sommelier for the Draycott Drams whisky club. You are knowledgeable about whisky, its production, tasting, and the specific whiskies in our collection. Be helpful, engaging, and expert-level in your responses. Keep responses conversational but informative.`;\n\n        const chat = model.startChat({\n          history: [\n            {\n              role: \"user\",\n              parts: [{ text: systemPrompt }],\n            },\n            {\n              role: \"model\",\n              parts: [{ text: \"I understand. I'm ready to help with whisky-related questions and discussions.\" }],\n            },\n            ...context.map(msg => ({\n              role: msg.role === \"user\" ? \"user\" : \"model\",\n              parts: [{ text: msg.content }],\n            })),\n          ],\n        });\n\n        const result = await chat.sendMessage(message);\n        const response = await result.response;\n        const text = response.text();\n\n        return {\n          response: text,\n          timestamp: new Date().toISOString(),\n        };\n      } catch (error) {\n        console.error(\"AI chat error:\", error);\n        throw new Error(\"Unable to respond at this time\");\n      }\n    }),\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 813, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/lib/routers/app.ts"],"sourcesContent":["import { createTRPCRouter } from \"@/lib/trpc\";\nimport { whiskyRouter } from \"./whisky\";\nimport { userRouter } from \"./user\";\nimport { tastingRouter } from \"./tasting\";\nimport { aiRouter } from \"./ai\";\n\nexport const appRouter = createTRPCRouter({\n  whisky: whiskyRouter,\n  user: userRouter,\n  tasting: tastingRouter,\n  ai: aiRouter,\n});\n\n// Export type definition of API\nexport type AppRouter = typeof appRouter;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,MAAM,YAAY,IAAA,iIAAgB,EAAC;IACxC,QAAQ,0IAAY;IACpB,MAAM,sIAAU;IAChB,SAAS,4IAAa;IACtB,IAAI,kIAAQ;AACd"}},
    {"offset": {"line": 837, "column": 0}, "map": {"version":3,"sources":["file:///home/tom/code/DraycottDrams/app/api/trpc/%5Btrpc%5D/route.ts"],"sourcesContent":["import { fetchRequestHandler } from \"@trpc/server/adapters/fetch\";\nimport { appRouter } from \"@/lib/routers/app\";\nimport { createTRPCContext } from \"@/lib/trpc\";\n\nconst handler = (request: Request) =>\n  fetchRequestHandler({\n    endpoint: \"/api/trpc\",\n    req: request,\n    router: appRouter,\n    createContext: () => createTRPCContext(request as any),\n  });\n\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,UAAU,CAAC,UACf,IAAA,gMAAmB,EAAC;QAClB,UAAU;QACV,KAAK;QACL,QAAQ,oIAAS;QACjB,eAAe,IAAM,IAAA,kIAAiB,EAAC;IACzC"}}]
}